PREFIX?=
BUILD_DIR?=$(shell defaults read com.apple.Xcode PBXProductDirectory 2> /dev/null)

ifeq ($(strip $(BUILD_DIR)),)
	BUILD_DIR=build
endif

PLAYERPRO_TARGET=Cocoa
PLAYER_TARGET="PlayerPRO Player"
MDIMPORT_TARGET=PPImport

DEFAULT_BUILDCONFIGURATION=Release
DEFAULT_TARGET=$(PLAYERPRO_TARGET)
BUILDCONFIGURATION?=$(DEFAULT_BUILDCONFIGURATION)

CP=ditto --rsrc
RM=rm

.PHONY: all playerpro playerpro6 mdimport player clean latest

playerpro: playerpro6

playerpro6:
	xcodebuild -project PPMacho.xcodeproj -target $(PLAYERPRO_TARGET) -configuration $(BUILDCONFIGURATION) build

player:
	xcodebuild -project PPMacho.xcodeproj -target $(PLAYER_TARGET) -configuration $(BUILDCONFIGURATION) build

mdimport:
	xcodebuild -project PPMacho.xcodeproj -target $(MDIMPORT_TARGET) -configuration $(BUILDCONFIGURATION) build

#install:
#	    cp -R build/Adium.app ~/Applications/
#	    cp -R build/AIUtilities.framework ~/Library/Frameworks/

clean:
	xcodebuild -project PPMacho.xcodeproj -target $(MDIMPORT_TARGET) -configuration $(BUILDCONFIGURATION) clean
	xcodebuild -project PPMacho.xcodeproj -target $(PLAYERPRO_TARGET) -configuration $(BUILDCONFIGURATION) clean
	xcodebuild -project PPMacho.xcodeproj -target $(PLAYER_TARGET) -configuration $(BUILDCONFIGURATION) clean

latest:
	git pull
	make playerpro6
	make player
	make mdimport

all: playerpro6 mdimport player
